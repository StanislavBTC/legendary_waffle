Цель написать мощный кросплатформенный межсетевой экран для серверного оборудования аналог проекта SentraWal. 

Sniffnet, Wireshark, CloudShark, Tcpdump - основные конкуренты. Всё выше указаные приложения в неком плане относятся 
к нашей целе, но приложения содеражт только определенные функции и не дают полного и свободного контроля и управления над трафиком.  
Моя цель создать приложение охватывающие максимум функций и вожностей взаимодействия с трафиком. 
Отталкиваться буду от приложения Sniffnet тк он достаточно удобный и содержит большое колчиество функций, а соответственно является
главным конкурентом за звание лучшего. 

Рассмотрим Sniffnet:

Основные возможности Sniffnet включают выбор сетевого адаптера, применение фильтров по типам трафика, 
просмотр статистики и реальных графиков трафика, импорт и экспорт файлов PCAP, определение множества сетевых сервисов и протоколов, 
геолокацию удалённых хостов, уведомления о сетевых событиях и многое другое. 

Функционал:
 - Мониторинг и отображение всего входящего и исходящего интернет-трафика в реальном времени.
 - Выбор сетевого адаптера и настройка фильтров по протоколам, адресам, портам и сервисам.
 - Визуализация графиков интенсивности трафика (байты и пакеты в секунду)
 - Просмотр подробной статистики и списка активных соединений.
 - Импорт и экспорт сетевого трафика в формате PCAP.
 - Ведение текстовых отчетов и журналов с возможностью их сохранения.
 - Уведомления о событиях при превышении заданных порогов трафика или активности избранных соединений.
 - Геолокация удалённых хостов и распознавания более 6000 сетевых сервисов.
 - Мини-интерфейс для постоянного фонового мониторинга.
 - Возможность создавать избранные хосты и группировать их для удобства мониторинга.
 - Поддержку мультиязычного интерфейса.
 - Настройки визуальных тем оформления.
 - Частое обновление бд сетевых сервисов и протоколов.
 - Кроссплатформенность.

Чего в Sniffnet нет:

 - Глубокий анализ содержимого пакетов и декодирование сложных протоколов.
 - Функции активного перехвата или модификации сетевого трафика (например, вставка, повторная передача).
 - Поддержка сложных сценариев сетевого обнаружения вторжений (IDS/IPS).
 - Расширенные возможности для настройки и автоматизации анализа (скрипты, плагины).
 - Широкие корпоративные функции, такие как централизованный сбор и агрегация данных с множества устройств.
 - Многоуровневая аутентификация пользователей и управление доступом.
 - Интеграция с системами безопасности или SIEM.
 - Встроенный анализ трафика на уровень приложений (например, анализ трафика HTTP/HTTPS с просмотром сессий).
 - Поддержка анализа IPv6 в полном объеме.
 - Автоматическое обнаружение и классификация аномалий или подозрительного поведения.
 - Обширные возможности экспорта данных помимо PCAP (например, в базы данных или другие форматы отчетов).
 - Встроенные возможности настройки сетевых политик или firewall.
 - отсутствует поддержка DNS over HTTPS

Чтобы создать основу своего приложения будут использованы следущие библиотеки (для сбора и парсинга сетевых пакетов):

 - scapy - инструмент для создания, захвата, анализа и модификации сетевых пакетов.
 - pyshark - обертка над Wireshark для разбора и анализа PCAP - файлов.
 - pcapy - библиотека для захвата пакетов в реальном времени с сетевых интерфейсов.
 - socket - стандартная библиотека для работы с сетью на низком уровне.
 - dpkt - быстрый анализатор пакетов, поддерживает множество сетевых протоколов.
 - netifaces - для получения информации о сетевых интерфейсах.
 - pydivert - для перехвата и модификации пакетов в Windows (работает поверх WinDivert).
 - winpcapy - Windows-версия pcapy для перехвата пакетов.
 - pyicmp - библиотека для работы с ICMP-пакетами.

Для визуализации:
 - matplotlib, plotly - dash - для графиков и дашбордов. # GUI only

Далее чуть более подробный план:

	1.	Цели

    - Модульность: чёткое разделение всех функций.
    - Кроссплатформенность. Работа на Linux, Windows, macOS.
    - Расширяемость: плагинная система для анализа и автоматизации.

	2.	Основные функциональные блоки

    - Agent (захват пакетов) (служба, которая напрямую получает сетевые пакеты с интерфейса и извлекает ключевую информацию о соединениях):
             интерфейс с libpcap (или эквивалент) для пассивного захвата. 
        ## (Skip) Поддержка BPF-фильтров (BPF — Berkeley Packet Filter, механизм фильтрации пакетов на уровне ядра Linux/Windows)
             на этапе ядра для уменьшения объёма обрабатываемых пакетов. 
        Сохраняет только агрегированные метаданные соединений (flows) в памяти или базе данных без записи самих пакетов.
    - Parser / Flow extractor (модуль, который анализирует пакеты и выделяет связи между ними — потоки данных): 
             извлечение метаданных flow (5-tuple, bytes, packets, timestamps, flags), 
        обнаружение L7-хинтов (SNI, JA3) (подсказки уровня приложений, такие как Server Name Indication и TLS-отпечаток клиента JA3), 
             (простые сигнатуры) без глубокого декодирования payload по умолчанию.
    - Enrichment: GeoIP, ASN, reverse DNS, WHOIS, TLS fingerprinting (JA3/JA3S), service fingerprints (порт+серия эвристик).
    - Storage: хранение метаданных flows и агрегатов трафика в БД; опциональное использование InfluxDB/ClickHouse для временных рядов.
    - Backend/API: REST + WebSocket (реaltime) для UI и интеграций. Возможность экспорта агрегатов по фильтрам.
    - UI/Dashboard: realtime-графики (bytes/sec, pkts/sec), топ-хосты/портов, таблицы активных соединений, карта геолокации,
        rule-builder для алертов, страницы управления плагинами.
    - Rule Engine / Alerts: пороговые, сигнатурные и поведенческие правила; действия — уведомление, 
             дополнительное логирование метаданных подозрительных потоков или уведомления, запуск плагина, webhook.

	3.	Нефункциональные требования

    - Производительность: минимальная потеря пакетов при умеренной нагрузке (зависит от hardware). 
             Использовать многопроцессную обработку (использование нескольких процессов Python для параллельного анализа данных) парсинга и буферизацию захвата.
    - Надёжность: устойчивость к отказам (watchdog (служба наблюдения, автоматически перезапускающая процессы при сбое), автоматический рестарт агента, 
             корректное завершение ротации).
    - Масштабируемость: возможность собрать несколько агентов и передавать метаданные в центральный collector.
    - Конфиденциальность: шифрование резервных копий, минимизация логирования содержимого, аудит доступа.

	4.	Архитектура данных и потоки

    - Захват → кольцевой буфер (структура памяти, где новые данные перезаписывают старые при заполнении) 
             в памяти → очередь сообщений → парсеры → запись метаданных в БД и публикация в WebSocket 
             (протокол двусторонней передачи данных между клиентом и сервером в реальном времени).
    - Агент отправляет агрегированные записи о потоках (flows) в очередь/БД; для анализа используются только метаданные.
    - Метаданные flow включают: ts_start, ts_end, src_ip, dst_ip, sport, dport, proto, bytes, packets, flags, sni, ja3, geoip_city, asn, tags.
    - Для быстрых запросов top-N использовать агрегаты и материализованные представления; для детального исследования — выборка по метаданным.

	5.	Хранилище и retention

    - Данные состоят только из агрегированных записей о потоках и статистике трафика; длительность хранения и глубина детализации регулируются политиками retention.
    - Краткосрочные оперативные данные (0–7 дней): хранить в TSDB (time-series database — база данных для хранения временных рядов, например InfluxDB или 
             TimescaleDB) / OLAP (быстрый доступ для dashboard).
    - Среднесрочные агрегаты (7–90 дней): сохранить агрегации (hourly/daily) в ClickHouse/Postgres (системы для хранения и аналитики больших объёмов данных).
    - Политики retention и автоматической очистки: настраиваемые per-agent и per-tenant.

	6.	Enrichment и классификация

    - GeoIP (определение географического положения по IP-адресу): локальные базы MaxMind / публичные базы с периодическим обновлением.
    - ASN (Autonomous System Number — номер автономной системы в Интернете) и WHOIS (служба, предоставляющая регистрационные данные о доменах и IP-адресах): 
             кеширование результатов, асинхронное обновление в фоне.
    - TLS fingerprint (JA3) (цифровой отпечаток, который позволяет идентифицировать клиента по набору параметров TLS-соединения), SNI извлечение: 
             считывать только заголовочные данные TLS без расшифровки.
    - Сервисная классификация: гибрид сигнатур + эвристики + периодическое обновление базы сигнатур.

	7.	Rule Engine и детекция аномалий

    - Rule types: threshold-based (на основе пороговых значений, например, превышения объёма трафика) (трафик/количество соединений), 
             signature-based (по заранее известным шаблонам поведения или атакам) (по известным комбинациям), stateful (с отслеживанием состояния соединений во времени) 
             (например, SYN-flood), и scheduled checks.
    - Actions: отправка уведомлений (email/webhook), дополнительное логирование метаданных подозрительных потоков или уведомления, запуск плагина для углублённого анализа, 
             интеграция в SIEM.
    - ML/Statistical module (опционально): отклонения от базовой линии трафика на уровне хостов/подсетей; модель обучается на исторических агрегатах и запускается 
             оффлайн/онлайн.

	8.	Plugins и API для расширения

    - Интерфейс: плагины реализуют контракт analyze(flow, context) -> events; плагины не должны иметь права напрямую модифицировать системные файлы.
    - Sandbox: запуск плагинов в отдельном процессе или контейнере; лимит CPU/memory; коммуникация через protobuf/JSON over IPC (межпроцессное взаимодействие 
             с использованием сериализации данных в форматах Protobuf или JSON).
    - Подписка: менеджер плагинов может подписываться на потоки событий по фильтрам.

	9.	UI / UX требования

    - Главная дэшборд-страница: realtime графики bytes/sec и pkts/sec, top N hosts, top N ports, активные соединения.
    - Фильтры & поиск: визуальный конструктор BPF (Berkeley Packet Filter, фильтрует пакеты по IP, порту и протоколу ещё до их анализа) + текстовый режим; 
             сохранение пользовательских фильтров.
    - Inspector для flow: timeline (временная диаграмма, показывающая ход соединения и передачи данных), handshake summary (TCP flags, SNI, JA3, ASN, geo), 
             просмотр детальных метаданных потока, включая временные ряды и признаки активности.
    - Alerts view: список активных и исторических алертов, acknowledge, комментарии и экспорт в CSV/JSON.
    - Map view: интерактивная карта с геолокацией хостов и heatmap-телек (тепловая карта активности, показывающая плотность соединений на карте мира). # GUI ONLY

	10.	Безопасность и права доступа

    - Аутентификация: поддержка LDAP/SSO (OIDC/SAML) (протоколы единой аутентификации, используемые для интеграции с корпоративными системами) и локальных пользователей.
    - Авторизация: RBAC (Role-Based Access Control — управление доступом на основе ролей пользователей) (роли: admin, analyst, observer), 
             отдельные права на экспорт и управление плагинами.
    - Аудит: журнал входов/действий и доступ к данным (кто, когда, зачем).

	11.	Тестирование и валидация

    - Unit и integration тесты для parser/flow extraction и rule engine.
    - Нагрузочное тестирование: генерация synthetic traffic (iperf/tcpreplay) и замеры потерь пакетов, задержек и использования CPU/RAM.
    - Тесты безопасности: проверка прав доступа, попытки запуска вредоносных плагинов в sandbox.

	12.	Развёртывание и операционная часть

    - Packaging: wheel/container images для агента и backend; systemd/unit для Linux и Windows service wrapper.
    - Обновления: безопасный механизм обновления агентов (upgrade with rollbacks) и автоматическое обновление подписей/баз.
    - Мониторинг самого сервиса: healthchecks, metrics экспорт (Prometheus) (популярная система мониторинга и сбора метрик) и alerting по состоянию агентов.

	13.	Документация и onboarding

    - Quickstart guide: установка агента, запуск захвата, базовые фильтры.
    - Руководство администратора: описание структуры метаданных flows, методов фильтрации и анализа.
    - Руководство по плагинам: API контракт, best-practices по безопасности.

	14.	MVP-дорожная карта (детализированный план)

    - Спринт 0 (подготовка): выбрать стек Python-библиотек, настроить репозиторий, CI, базовую структуру проекта.
    - Спринт 1 (1 неделя): простой capture-agent (BPF filter support (поддержка фильтрации пакетов на уровне ядра для ускорения захвата)) + minimal parser, 
             сохранение метаданных в sqlite.
    - Спринт 2 (1 неделя): backend (REST + WebSocket) и простая dashboard-страница с realtime графиками (polling/WebSocket).
    - Спринт 3 (2 недели): enrichment (GeoIP, ASN, reverse DNS), топ-панели, экспорт агрегатов по фильтру.
    - Спринт 4 (2 недели): rule engine (threshold rules), уведомления (webhook/email), сохранение алертов в БД.
    - Спринт 5 (2 недели): плагинная архитектура (sandboxed plugins), менеджер плагинов и интерфейс для включения/выключения.
    - Спринт 6 (2–4 недели): hardening, нагрузочное тестирование, документация, пакеты, базовое RBAC и безопасность.
    - Спринт 7 (2 недели): реализация TUI-интерфейса на базе textual/rich, интеграция с backend по WebSocket, отображение метрик, flows и алертов в реальном времени.

	15.	Рекомендованные папки/файлы в репозитории

    - /agent — capture agent и утилиты управления (конфиги, systemd unit templates)
    - /parser — парсеры и flow-extractor
    - /backend — API server, rule engine, enrichment workers
    - /ui — frontend/dashboards
    - /plugins — пример плагинов и интерфейс для них
    - /docs — документация и quickstarts



	16.	Юридические и этические требования (обязательные)

    - Перед развёртыванием получить письменное разрешение от владельцев сетей и пользователей при необходимости.
    - По умолчанию хранить только метаданные; содержимое payload сохранять только при явном назначении и с аудитом.
    - Включить функции удаления/маскировки чувствительных данных из экспортов.

	17.	Следующие шаги (что сделать прямо сейчас)

    - Подтвердите целевой стек Python-библиотек (например, pypcap/dpkt/geoip2/fastapi/dash).
    - Решите требования к хранению (локально vs S3) и retention policy для метаданных и временных рядов.
    - Определите приоритеты MVP-спринтов и ресурсы (сколько devs, доступный infra).

	18.	TUI (Text User Interface)

    - Основные функции:
        - Отображение ключевых метрик: входящий/исходящий трафик, пакеты в секунду, активные соединения, топ-хосты и топ-порты.
        - Реалтайм-дашборд с обновлением не реже 1 раза в секунду.
        - Переключаемые вкладки (Dashboard, Flows, Alerts, Filters, Settings).
        - Поддержка горячих клавиш (например, f — фильтр, a — алерты, ctrl+c — выход).
        - Встроенные мини-графики (sparklines) и таблицы с цветовой подсветкой.
        - Интеграция с Rule Engine и Alerts для отображения событий и уведомлений.
        - Возможность экспорта данных из TUI (в CSV/JSON).
        - Поддержка светлой и тёмной темы оформления.

    - Архитектура TUI:
        Собственная

    - Используемые библиотеки:
        - textual (современный Python-фреймворк для создания TUI-приложений, поддерживает async и layout-систему) — современная библиотека для TUI 
                 с поддержкой async и layout.
        - rich (библиотека для форматирования текста и отрисовки таблиц, графиков и логов в терминале) — форматирование таблиц, графиков и логов.
        - prompt_toolkit (фреймворк для создания интерактивных CLI и TUI с автодополнением и горячими клавишами) или urwid — альтернатива для классического TUI.

    - Нефункциональные требования:
        - Совместимость с Linux, macOS и Windows Terminal.
        - Обновление данных без мерцаний (асинхронный refresh loop).
        - Возможность запуска без root (чтение данных из backend API).
        - Минимальная нагрузка на CPU (<5% при стандартной визуализации).

    - MVP TUI:
        - Главный экран с графиками bytes/sec и pkts/sec.
        - Таблица активных соединений с фильтрацией.
        - Панель алертов.
        - Строка состояния с интерфейсом, временем и статусом агента.
        
    - Расширения:
        - Split-screen режим (flows + alerts). # Не уверен что нужно
        - Контекстные меню и горячие действия.
        - Экспорт snapshot’ов экрана для отчётов.
        - Настраиваемые темы оформления.
